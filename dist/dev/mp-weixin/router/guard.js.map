{"version":3,"file":"guard.js","sources":["../../../../src/router/guard.ts"],"sourcesContent":["import type { Router } from 'uni-mini-router/lib/interfaces';\nimport { isLogin } from '@/utils/auth';\n\nexport function createRouterGuard(router: Router) {\n  createBeforeEachGuard(router);\n  createAfterEachGuard(router);\n}\n\nfunction createBeforeEachGuard(router: Router) {\n  router.beforeEach((to, _, next) => {\n    const _isLogin = isLogin();\n    if (to && to?.meta?.ignoreAuth) {\n      // 如果目标路由忽略验证直接跳转\n      next();\n    } else if (!_isLogin && to && to.name !== 'Login') {\n      // 如果没有登录且目标路由不是登录页面则跳转到登录页面\n      // 将目标路由和参数传入登录页面，登录成功后直接跳转到目标路由，优化体验\n      next({ name: 'Login', params: { redirect: to.name!, ...to.query }, navType: 'push' });\n    } else if (_isLogin && to && to.name === 'Login') {\n      // 如果已经登录且目标页面是登录页面则跳转至首页\n      next({ name: 'Home', navType: 'replaceAll' });\n    } else {\n      next();\n    }\n    next();\n  });\n}\n\nfunction createAfterEachGuard(router: Router) {\n  router.afterEach((to) => {\n    if (to && to?.meta?.ignoreAuth)\n      return;\n    const _isLogin = isLogin();\n    if (!_isLogin && to && to.name !== 'Login') {\n      // 如果没有登录且目标路由不是登录页面则跳转到登录页面\n      router.push({ name: 'Login', params: { ...to.query } });\n    } else if (_isLogin && to && to.name === 'Login') {\n      // 如果已经登录且目标页面是登录页面则跳转至首页\n      router.replaceAll({ name: 'Home' });\n    }\n  });\n}\n"],"names":["isLogin"],"mappings":";;;;;;;;;;;;;;;;;;AAGO,SAAS,kBAAkB,QAAgB;AAChD,wBAAsB,MAAM;AAC5B,uBAAqB,MAAM;AAC7B;AAEA,SAAS,sBAAsB,QAAgB;AAC7C,SAAO,WAAW,CAAC,IAAI,GAAG,SAAS;;AACjC,UAAM,WAAWA,WAAAA;AACb,QAAA,QAAM,8BAAI,SAAJ,mBAAU,aAAY;AAEzB;IAAA,WACI,CAAC,YAAY,MAAM,GAAG,SAAS,SAAS;AAGjD,WAAK,EAAE,MAAM,SAAS,QAAQ,iBAAE,UAAU,GAAG,QAAU,GAAG,QAAS,SAAS,OAAQ,CAAA;AAAA,IAC3E,WAAA,YAAY,MAAM,GAAG,SAAS,SAAS;AAEhD,WAAK,EAAE,MAAM,QAAQ,SAAS,aAAc,CAAA;AAAA,IAAA,OACvC;AACA;IACP;AACK;EAAA,CACN;AACH;AAEA,SAAS,qBAAqB,QAAgB;AACrC,SAAA,UAAU,CAAC,OAAO;;AACnB,QAAA,QAAM,8BAAI,SAAJ,mBAAU;AAClB;AACF,UAAM,WAAWA,WAAAA;AACjB,QAAI,CAAC,YAAY,MAAM,GAAG,SAAS,SAAS;AAEnC,aAAA,KAAK,EAAE,MAAM,SAAS,QAAQ,mBAAK,GAAG,OAAM,CAAG;AAAA,IAC7C,WAAA,YAAY,MAAM,GAAG,SAAS,SAAS;AAEhD,aAAO,WAAW,EAAE,MAAM,OAAQ,CAAA;AAAA,IACpC;AAAA,EAAA,CACD;AACH;AAAA,QAAA,IAAA;"}