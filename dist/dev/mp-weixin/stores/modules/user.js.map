{"version":3,"file":"user.js","sources":["../../../../../src/stores/modules/user.ts"],"sourcesContent":["import { defineStore } from 'pinia';\nimport { getUserInfoApi } from '@/services/api/user';\nimport type { UserInfoModel } from '@/services/model/userModel';\nimport { login as loginApi } from '@/services/api/auth';\nimport { getToken, isLogin, setToken } from '@/utils/auth';\nimport { removeCache } from '@/utils/cache';\nimport { TOKEN_KEY } from '@/enums/cacheEnum';\n\nexport const useUserStore = defineStore('UserStore', () => {\n  const token = ref<string | null>(null);\n  const userInfo = ref<UserInfoModel | null>(null);\n\n  // 初始化\n  function initUserInfo() {\n    if (isLogin()) {\n      token.value = getToken();\n      getUserInfo();\n    }\n  }\n\n  // 是否登录\n  const loggedIn = computed(() => !!token.value);\n\n  // 登录\n  const { send: sendLogin } = useRequest(loginApi, { immediate: false });\n  async function login(params: LoginParams) {\n    try {\n      const res = await sendLogin(params);\n      token.value = res.token;\n      setToken(res.token);\n      await getUserInfo();\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // 获取用户信息\n  const { send: _getUserInfo } = useRequest(getUserInfoApi, { initialData: null, immediate: false });\n  async function getUserInfo() {\n    try {\n      userInfo.value = await _getUserInfo();\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // 登出\n  // const { send: sendLogout } = useRequest(logoutApi, { immediate: false });\n  async function logout() {\n    try {\n      // await sendLogout();\n      removeCache(TOKEN_KEY);\n      userInfo.value = null;\n      token.value = null;\n    } catch (err: any) {\n      throw err;\n    }\n  }\n\n  return {\n    userInfo,\n    loggedIn,\n    login,\n    logout,\n    getUserInfo,\n    initUserInfo,\n  };\n});\n"],"names":["defineStore","ref","isLogin","getToken","computed","useRequest","loginApi","setToken","getUserInfoApi","removeCache","TOKEN_KEY"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAQa,MAAA,gBAAA,QAAA,wBAAA,GAAA,oBAAA,QAAA,4BAAA,GAAA,oBAAA,QAAA,4BAAA,GAAA,aAAA,QAAA,qBAAA,GAAA,oBAAA,QAAA,4BAAA,GAAA,kBAAA,QAAA,0BAAA;AAAA,MAAA,eAAeA,cAAAA,EAAY,aAAa,MAAM;AACnD,QAAA,QAAQC,gBAAmB,IAAI;AAC/B,QAAA,WAAWA,gBAA0B,IAAI;AAG/C,WAAS,eAAe;AACtB,QAAIC,gBAAW;AACb,YAAM,QAAQC,WAAAA;AACF;IACd;AAAA,EACF;AAGA,QAAM,WAAWC,cAAAA,EAAS,MAAM,CAAC,CAAC,MAAM,KAAK;AAGvC,QAAA,EAAE,MAAM,cAAcC,cAAAA,EAAWC,kBAAAA,GAAU,EAAE,WAAW,MAAA,CAAO;AACrE,WAAe,MAAM,QAAqB;AAAA;AACpC,UAAA;AACI,cAAA,MAAM,MAAM,UAAU,MAAM;AAClC,cAAM,QAAQ,IAAI;AAClBC,qBAAS,IAAI,KAAK;AAClB,cAAM,YAAY;AAAA,eACX,OAAO;AACR,cAAA;AAAA,MACR;AAAA,IACF;AAAA;AAGM,QAAA,EAAE,MAAM,aAAiB,IAAAF,gBAAWG,kBAAAA,GAAgB,EAAE,aAAa,MAAM,WAAW,MAAO,CAAA;AACjG,WAAe,cAAc;AAAA;AACvB,UAAA;AACO,iBAAA,QAAQ,MAAM;eAChB,OAAO;AACR,cAAA;AAAA,MACR;AAAA,IACF;AAAA;AAIA,WAAe,SAAS;AAAA;AAClB,UAAA;AAEFC,0BAAA,EAAYC,gBAAS,CAAA;AACrB,iBAAS,QAAQ;AACjB,cAAM,QAAQ;AAAA,eACP,KAAU;AACX,cAAA;AAAA,MACR;AAAA,IACF;AAAA;AAEO,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ,CAAC;AAAA,QAAA,IAAA;"}